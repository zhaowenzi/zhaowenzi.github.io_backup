[{"title":"hexo博客搭建","date":"2019-06-03T03:51:44.000Z","path":"2019/06/03/start-hexo/","text":"安装NodeJS和NPM1curl --silent --location https://rpm.nodesource.com/setup_10.x | sudo bash - 1yum install -y nodejs 安装Nginx1vim /etc/yum.repos.d/nginx.repo 将以下内容拷贝进去 12345[nginx]name=nginx repobaseurl=http://nginx.org/packages/centos/$releasever/$basearch/gpgcheck=0enabled=1 安装 1yum install nginx -y 由于centos默认自带防火墙，所以这里需要关闭防火墙才能访问 123systemctl start firewalld.service #启动firewallsystemctl stop firewalld.service #停止firewallsystemctl disable firewalld.service #禁止firewall开机启动 安装git并设置1234yum install git #安装gitssh-keygen -t rsa -b 4096 -C \"xxxxx@xxx.com\" #生成公钥cat ~/.ssh/id_rsa.pub #查看公钥，并把它复制到github账户中 拉取仓库并配置nginx123git clone ...vim /etc/nginx/conf.d/hexo.conf 写入下列相应配置 12345678server &#123; listen 80; server_name blog.zhaoziwen.com.cn; location / &#123; root /root/zhaowenzi.github.io; index index.html; &#125;&#125; 重启生效 1nginx -s reload 修改nginx权限 1234vim /etc/nginx/nginx.conf#将user nginx; 改为 user root; #然后再次重启 配置webhooks自动更新博客安装依赖库 1npm install -g github-webhook-handler 配置webhook.js 1vim webhooks.js 将下面的配置写入上面的文件 12345678910111213141516171819202122232425262728293031var http = require('http')var createHandler = require('github-webhook-handler')var handler = createHandler(&#123; path: '/webhooks_push', secret: '***' &#125;)// 上面的 secret 保持和 GitHub 后台设置的一致function run_cmd(cmd, args, callback) &#123; var spawn = require('child_process').spawn; var child = spawn(cmd, args); var resp = \"\"; child.stdout.on('data', function(buffer) &#123; resp += buffer.toString(); &#125;); child.stdout.on('end', function() &#123; callback (resp) &#125;);&#125;http.createServer(function (req, res) &#123; handler(req, res, function (err) &#123; res.statusCode = 404 res.end('no such location') &#125;)&#125;).listen(6666)handler.on('error', function (err) &#123; console.error('Error:', err.message)&#125;)handler.on('push', function (event) &#123; console.log('Received a push event for %s to %s', event.payload.repository.name, event.payload.ref); run_cmd('sh', ['./deploy.sh'], function(text)&#123; console.log(text) &#125;);&#125;) 配置./deploy.sh 1vim deploy.sh 写入 12cd ~/zhaowenzi.github.iogit pull 用pm2来实现守护进程 1npm install pm2 --global 通过pm2启动webhooks.js 1pm2 start webhooks.js 全站HTTPS通过Certbot傻瓜操作 123wget https://dl.eff.org/certbot-autochmod a+x certbot-autosudo ./certbot-auto --nginx 通过crontab定时任务自动更新 1crontab -e 添加下面这条命令 10 0 * * 0 /root/certbot-auto renew 即每周日的0点0分执行更新证书的命令","tags":[{"name":"hexo","slug":"hexo","permalink":"https://blog.zhaoziwen.com.cn/tags/hexo/"}]},{"title":"Hello World","date":"2019-06-02T16:01:41.400Z","path":"2019/06/03/hello-world/","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","tags":[]}]