<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    

    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?74de4378fdea19ed4f59264fe4bd6716"></script>
<!-- End Baidu Tongji -->



<!-- Baidu Push -->
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<!-- End Baidu Push -->


    <meta charset="utf-8">
    
    
    
    
    <title>APUE 第三章 文件I/O | Mose&#39;s blog | Think Deeper &amp; Work Harder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="apue">
    <meta name="description" content="文件描述符对于内核而言，所有打开的文件都通过文件描述符引用。它是一个非负整数。 UNIX系统shell把文件描述符0（STDIN_FILENO）与进程的标准输入关联，1（STDOUT_FILENO）与标准输出关联，2（STDERR_FILENO）与标准错误关联。 函数open和openat调用这两个函数可以打开或创建一个文件。 123#include &amp;lt;fcntl.h&amp;gt;int open">
<meta name="keywords" content="apue">
<meta property="og:type" content="article">
<meta property="og:title" content="APUE 第三章 文件I&#x2F;O">
<meta property="og:url" content="https://zhaoziwen.com.cn/archives/1ffc7233.html">
<meta property="og:site_name" content="Mose&#39;s blog">
<meta property="og:description" content="文件描述符对于内核而言，所有打开的文件都通过文件描述符引用。它是一个非负整数。 UNIX系统shell把文件描述符0（STDIN_FILENO）与进程的标准输入关联，1（STDOUT_FILENO）与标准输出关联，2（STDERR_FILENO）与标准错误关联。 函数open和openat调用这两个函数可以打开或创建一个文件。 123#include &amp;lt;fcntl.h&amp;gt;int open">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://hexo-blog-1252103983.cos.ap-guangzhou.myqcloud.com/20190625201806.png">
<meta property="og:image" content="https://hexo-blog-1252103983.cos.ap-guangzhou.myqcloud.com/20190625205535.png">
<meta property="og:image" content="https://hexo-blog-1252103983.cos.ap-guangzhou.myqcloud.com/20190627134159.png">
<meta property="og:image" content="https://hexo-blog-1252103983.cos.ap-guangzhou.myqcloud.com/20190627150748.png">
<meta property="og:updated_time" content="2019-06-27T07:16:19.821Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="APUE 第三章 文件I&#x2F;O">
<meta name="twitter:description" content="文件描述符对于内核而言，所有打开的文件都通过文件描述符引用。它是一个非负整数。 UNIX系统shell把文件描述符0（STDIN_FILENO）与进程的标准输入关联，1（STDOUT_FILENO）与标准输出关联，2（STDERR_FILENO）与标准错误关联。 函数open和openat调用这两个函数可以打开或创建一个文件。 123#include &amp;lt;fcntl.h&amp;gt;int open">
<meta name="twitter:image" content="https://hexo-blog-1252103983.cos.ap-guangzhou.myqcloud.com/20190625201806.png">
    
        <link rel="alternate" type="application/atom+xml" title="Mose&#39;s blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide">
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/psb.jpeg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">z2w</h5>
          <a href="mailto:me@zhaoziwen.com.cn" title="me@zhaoziwen.com.cn" class="mail">me@zhaoziwen.com.cn</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/">
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect active">
              <a href="/archives">
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags">
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories">
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/zhaowenzi" target="_blank" rel="external nofollow noopener noreferrer">
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.weibo.com/FTC0003" target="_blank" rel="external nofollow noopener noreferrer">
                <i class="icon icon-lg icon-weibo"></i>
                Weibo
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">APUE 第三章 文件I/O</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">APUE 第三章 文件I/O</h1>
        <h5 class="subtitle">
            
                <time datetime="2019-06-27T07:15:37.000Z" itemprop="datePublished" class="page-time">
  2019-06-27
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/UNIX环境高级编程/">UNIX环境高级编程</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件描述符"><span class="post-toc-number">1.</span> <span class="post-toc-text">文件描述符</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数open和openat"><span class="post-toc-number">2.</span> <span class="post-toc-text">函数open和openat</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数creat"><span class="post-toc-number">3.</span> <span class="post-toc-text">函数creat</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数close"><span class="post-toc-number">4.</span> <span class="post-toc-text">函数close</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数lseek"><span class="post-toc-number">5.</span> <span class="post-toc-text">函数lseek</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数read"><span class="post-toc-number">6.</span> <span class="post-toc-text">函数read</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数write"><span class="post-toc-number">7.</span> <span class="post-toc-text">函数write</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#文件共享"><span class="post-toc-number">8.</span> <span class="post-toc-text">文件共享</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#原子操作"><span class="post-toc-number">9.</span> <span class="post-toc-text">原子操作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#函数pread和pwrite"><span class="post-toc-number">9.1.</span> <span class="post-toc-text">函数pread和pwrite</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#创建一个文件"><span class="post-toc-number">9.2.</span> <span class="post-toc-text">创建一个文件</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数dup和dup2"><span class="post-toc-number">10.</span> <span class="post-toc-text">函数dup和dup2</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数sync、fsync和fdatasync"><span class="post-toc-number">11.</span> <span class="post-toc-text">函数sync、fsync和fdatasync</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数fcntl"><span class="post-toc-number">12.</span> <span class="post-toc-text">函数fcntl</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#函数ioctl"><span class="post-toc-number">13.</span> <span class="post-toc-text">函数ioctl</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#dev-fd"><span class="post-toc-number">14.</span> <span class="post-toc-text">/dev/fd</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#习题"><span class="post-toc-number">15.</span> <span class="post-toc-text">习题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-1"><span class="post-toc-number">15.1.</span> <span class="post-toc-text">3.1</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-2"><span class="post-toc-number">15.2.</span> <span class="post-toc-text">3.2</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-3"><span class="post-toc-number">15.3.</span> <span class="post-toc-text">3.3</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-4"><span class="post-toc-number">15.4.</span> <span class="post-toc-text">3.4</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-5"><span class="post-toc-number">15.5.</span> <span class="post-toc-text">3.5</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#3-6"><span class="post-toc-number">15.6.</span> <span class="post-toc-text">3.6</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-apue-3" class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">APUE 第三章 文件I/O</h1>
        <div class="post-meta">
            <time class="post-time" title="2019-06-27 15:15:37" datetime="2019-06-27T07:15:37.000Z" itemprop="datePublished">2019-06-27</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/UNIX环境高级编程/">UNIX环境高级编程</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style="display:none">
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h3><p>对于内核而言，所有打开的文件都通过文件描述符引用。它是一个非负整数。</p>
<p>UNIX系统shell把文件描述符0（STDIN_FILENO）与进程的标准输入关联，1（STDOUT_FILENO）与标准输出关联，2（STDERR_FILENO）与标准错误关联。</p>
<h3 id="函数open和openat"><a href="#函数open和openat" class="headerlink" title="函数open和openat"></a>函数open和openat</h3><p>调用这两个函数可以打开或创建一个文件。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">open</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *path, <span class="keyword">int</span> oflag, ... <span class="comment">/* mode_t mode */</span>)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">openat</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">char</span> *path, <span class="keyword">int</span> oflag, ... <span class="comment">/* mode_t mode */</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p>最后一个参数…代表余下的参数的数量及其类型是可变的。</p>
<p>path参数是要打开或创建文件的名字。oflag参数可用来说明此函数的多个选项。用下列一个或多个常量进行”或”运算构成oflag参数。</p>
<p>下列5个常量中指定一个且只能指定一个：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>O_RDONLY</td>
<td>只读打开</td>
</tr>
<tr>
<td>O_WRONLY</td>
<td>只写打开</td>
</tr>
<tr>
<td>O_RDWR</td>
<td>读、写打开</td>
</tr>
<tr>
<td>O_EXEC</td>
<td>只执行打开</td>
</tr>
<tr>
<td>O_SEARCH</td>
<td>只搜索打开（应用于目录）</td>
</tr>
</tbody></table>
<p>下列常量是可选择的：</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>O_APPEND</td>
<td>每次写时追加到文件尾端</td>
</tr>
<tr>
<td>O_CLOEXEC</td>
<td>把FD_CLOEXEC常量设置为文件描述符标志</td>
</tr>
<tr>
<td>O_CREAT</td>
<td>若此文件不存在则创建，同时open函数需要说明第3个mode参数（openat函数第4个参数mode），用mode指定该新文件的访问权限位</td>
</tr>
<tr>
<td>O_DIRECTORY</td>
<td>如果path引用的不是目录，则出错</td>
</tr>
<tr>
<td>O_EXCL</td>
<td>如果同时指定了O_CREAT，而文件已经存在则出错</td>
</tr>
<tr>
<td>O_NOCTTY</td>
<td>如果path引用的是终端设备，则不将该设备分配为此进程的控制终端</td>
</tr>
<tr>
<td>O_NOFOLLOW</td>
<td>如果path引用的是一个符号终端，则出错</td>
</tr>
<tr>
<td>O_NONBLOCK</td>
<td>如果path引用的是一个FIFO、一个块特殊文件或一个字符特殊文件，则此选项为文件的本次打开操作和后续的I/O操作设置非阻塞方式</td>
</tr>
<tr>
<td>O_SYNC</td>
<td>使每次write等待物理I/O操作完成，包括由该write操作引起的文件属性更新所需的I/O</td>
</tr>
<tr>
<td>O_TRUNC</td>
<td>如果此文件存在，而且为只写或读-写成功打开，则将其长度截断为0</td>
</tr>
<tr>
<td>O_TTY_INIT</td>
<td>如果打开一个还未打开的终端设备，设置非标准termios参数值，使其符合Single UNIX Specification</td>
</tr>
<tr>
<td>O_DSYNC</td>
<td>使每次write要等物理I/O操作完成，但是如果该写操作并不影响读取刚写入的数据，则不需要等待文件属性被更新</td>
</tr>
<tr>
<td>O_RSYNC</td>
<td>使每一个以文件描述符作为参数进行的read操作等待，直至所有对文件同一部分挂起的写操作都完成</td>
</tr>
</tbody></table>
<p>这两个函数返回的文件描述符一定是最小的未使用的描述符数值。</p>
<p>其中open函数和openat函数的区别在于：</p>
<ol>
<li>path参数指定的是绝对路径名，在这种情况下，fd参数被忽略，openat函数相当于open函数</li>
<li>path参数指定的是相对路径名，fd参数指出了相对路径名在文件系统中的开始地址。fd参数是通过打开相对路径名所在的目录来获取</li>
<li>path参数指定了相对路径名，fd参数具有特殊值AT_FDCWD。在这种情况下，路径名在当前工作目录中获取，openat函数在操作上与open函数类似</li>
</ol>
<h3 id="函数creat"><a href="#函数creat" class="headerlink" title="函数creat"></a>函数creat</h3><p>也可以调用creat函数创建一个新文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">creat</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *path, <span class="keyword">mode_t</span> mode)</span></span>;</span><br></pre></td></tr></table></figure>

<p>此函数等效于open(path, O_WRONLY | O_CREAT | O_TRUNC, mode);</p>
<p>该函数只能以只读的方式打开所创建的文件</p>
<h3 id="函数close"><a href="#函数close" class="headerlink" title="函数close"></a>函数close</h3><p>函数close可关闭一个打开的文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">close</span><span class="params">(<span class="keyword">int</span> fd)</span></span>;</span><br></pre></td></tr></table></figure>

<p>关闭一个文件还会释放该进程加在该文件上的所有锁</p>
<p>当一个进程终止时，内核自动地关闭它所有的打开的文件</p>
<h3 id="函数lseek"><a href="#函数lseek" class="headerlink" title="函数lseek"></a>函数lseek</h3><p>每个打开的文件都有一个”当前文件偏移量”，用来度量从文件开始处计算的字节数。通常，读写操作都从当前文件偏移量处开始，并使偏移量增加所读写的字节数。</p>
<p>lseek函数为一个打开的文件设置偏移量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">off_t</span> lseek(<span class="keyword">int</span> fd, <span class="keyword">off_t</span> offset, <span class="keyword">int</span> whence);</span><br></pre></td></tr></table></figure>

<p>对参数offset的解释与参数whence的值有关：</p>
<ul>
<li>若whence是SEEK_SET，则将该文件的偏移量设置为距文件开始处offset个字节</li>
<li>若whence是SEEK_CUR，则将该文件的偏移量设置为其当前值加offset，offset可为正或负</li>
<li>若whence是SEEK_END，则将该文件的偏移量设置为文件长度加offset，可正可负</li>
</ul>
<p>如果文件描述符指向的是一个管道、FIFO或网络套接字，则lseek返回-1，并将errno设置为ESPIPE</p>
<p>下面的程序用于测试对其标准输入能否设置偏移量</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"apue.h"</span></span></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (lseek(STDIN_FILENO, <span class="number">0</span>, SEEK_CUR) == <span class="number">-1</span>)</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"cannot seek\n"</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"seek OK\n"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>文件偏移量可以大于文件的当前长度，在这种情况下，对该文件的下一次写将加长该文件并在文件中构成一个空洞。位于文件中单没有写过的字节都被读为0。文件中的空洞并不要求在磁盘上占用存储区，当定位到超出文件尾端之后写时，对于新写的数据需要分配磁盘块，但是对于原文件尾端和新开始写位置的部分不需要分配磁盘快</p>
<p>下面的程序用于创建一个具有空洞的文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"apue.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> buf1[] = <span class="string">"abcdefghij"</span>;</span><br><span class="line"><span class="keyword">char</span> buf2[] = <span class="string">"ABCDEFGHIJ"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span></span><br><span class="line">main(<span class="keyword">void</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="keyword">if</span> ((fd = creat(<span class="string">"file.hole"</span>, FILE_MODE)) &lt; <span class="number">0</span>)</span><br><span class="line">        err_sys(<span class="string">"creat error"</span>);</span><br><span class="line">    <span class="keyword">if</span> (write(fd, buf1, <span class="number">10</span>) != <span class="number">10</span>)</span><br><span class="line">        err_sys(<span class="string">"buf1 write error"</span>);</span><br><span class="line">    <span class="keyword">if</span> (lseek(fd, <span class="number">16384</span>, SEEK_SET) == <span class="number">-1</span>)</span><br><span class="line">        err_sys(<span class="string">"lseek error"</span>);</span><br><span class="line">    <span class="keyword">if</span> (write(fd, buf2, <span class="number">10</span>) != <span class="number">10</span>)</span><br><span class="line">        err_sys(<span class="string">"buf2 write error"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数read"><a href="#函数read" class="headerlink" title="函数read"></a>函数read</h3><p>调用read函数从打开文件中读数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">ssize_t</span> read(<span class="keyword">int</span> fd, <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> nbytes);</span><br></pre></td></tr></table></figure>

<p>如read成功，则返回读到的字节数。如已达到文件的尾端，则返回0</p>
<p>读操作从文件的当前偏移量处开始，在成功返回之前，该偏移量将增加实际读到的字节数</p>
<h3 id="函数write"><a href="#函数write" class="headerlink" title="函数write"></a>函数write</h3><p>调用write函数想打开文件写数据</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">ssize_t</span> write(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> nbytes);</span><br></pre></td></tr></table></figure>

<p>其返回值通常与参数nbytes的值相同，否则表示出错。</p>
<p>对于普通文件，写操作从文件的当前偏移量处开始。如果在打开该文件时，指定了O_APPEND选项，则在每次写操作之前，将文件偏移量设置在文件的当前结尾处。在一次成功写之后，该文件偏移量增加实际写的字节数</p>
<h3 id="文件共享"><a href="#文件共享" class="headerlink" title="文件共享"></a>文件共享</h3><p>内核使用3中数据结构表示打开文件：</p>
<ol>
<li>每个进程在进程表中都有一个记录项，记录项中包含一张打开文件描述符表，可将其视为一个矢量，每个描述符占用一项。与每个文件描述符相关联的是：<ol>
<li>文件描述符标志</li>
<li>指向一个文件表项的指针</li>
</ol>
</li>
<li>内核为所有打开文件维持一张文件表。每个文件表项包含：<ol>
<li>文件状态标志（读、写、添写、同步与非阻塞等）</li>
<li>当前文件偏移量</li>
<li>指向该文件v结点表项的指针</li>
</ol>
</li>
<li>每个打开文件（或设备）都有一个v节点。v节点包含了文件类型和对此文件进行各种操作函数的指针。对于大多数文件，v节点还包含了该文件的i节点</li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://hexo-blog-1252103983.cos.ap-guangzhou.myqcloud.com/20190625201806.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>如果两个独立进程各自打开了同一文件，则有下图所示的关系</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://hexo-blog-1252103983.cos.ap-guangzhou.myqcloud.com/20190625205535.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<h3 id="原子操作"><a href="#原子操作" class="headerlink" title="原子操作"></a>原子操作</h3><h4 id="函数pread和pwrite"><a href="#函数pread和pwrite" class="headerlink" title="函数pread和pwrite"></a>函数pread和pwrite</h4><p>pread和pwrite这种拓展允许原子性地定位并执行I/O</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="keyword">ssize_t</span> pread(<span class="keyword">int</span> fd, <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> nbytes, <span class="keyword">off_t</span> offset);</span><br><span class="line"><span class="keyword">ssize_t</span> pwrite(<span class="keyword">int</span> fd, <span class="keyword">const</span> <span class="keyword">void</span> *buf, <span class="keyword">size_t</span> nbytes, <span class="keyword">off_t</span> offset);</span><br></pre></td></tr></table></figure>

<p>调用pread相当于调用lseek后调用read，但是pread又与这种顺序调用有下列重要区别：</p>
<ol>
<li>调用pread时，无法中断定位和读操作</li>
<li>不更新当前文件偏移量</li>
</ol>
<p>调用pwrite相当于调用lseek后调用write，但也有类似的区别</p>
<h4 id="创建一个文件"><a href="#创建一个文件" class="headerlink" title="创建一个文件"></a>创建一个文件</h4><p>在open函数中使用O_CREAT和O_EXCL选项时，是一个原子操作。但是使用open和creat来创建文件就会出现问题</p>
<h3 id="函数dup和dup2"><a href="#函数dup和dup2" class="headerlink" title="函数dup和dup2"></a>函数dup和dup2</h3><p>这两个函数都可以用来复制一个现有的文件描述符</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dup</span><span class="params">(<span class="keyword">int</span> fd)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dup2</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">int</span> fd2)</span></span>;</span><br></pre></td></tr></table></figure>

<p>由dup返回的新文件描述符一定是当前可用文件描述符中的最小数值。</p>
<p>对于dup2，可以用fd2参数指定新描述符的值。如果fd2已经打开，则先将其关闭。如果fd等于fd2，则dup2返回fd2，而不关闭它。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://hexo-blog-1252103983.cos.ap-guangzhou.myqcloud.com/20190627134159.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<h3 id="函数sync、fsync和fdatasync"><a href="#函数sync、fsync和fdatasync" class="headerlink" title="函数sync、fsync和fdatasync"></a>函数sync、fsync和fdatasync</h3><p>这三个函数可以保证磁盘上实际文件系统与缓冲区中内容一致性</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fsync</span><span class="params">(<span class="keyword">int</span> fd)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fdatasync</span><span class="params">(<span class="keyword">int</span> fd)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sync</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p>sync只是将所有修改过的块缓冲区排入写队列，然后就返回，并不等待实际写磁盘操作结束</p>
<p>fsync函数只对由文件描述符fd指定的一个文件起作用，并且等待写磁盘操作结束才返回</p>
<p>fdatasync函数类似fsync，但它只影响文件的数据部分。而除数据外，fsync还会同步更新文件的属性</p>
<h3 id="函数fcntl"><a href="#函数fcntl" class="headerlink" title="函数fcntl"></a>函数fcntl</h3><p>fcntl函数可以改变已经打开文件的属性</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fcntl</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">int</span> cmd, ... <span class="comment">/* int arg */</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<p>fcntl函数有以下5种功能：</p>
<ol>
<li>复制一个已有的描述符（cmd = F_DUPFD或F_DUPFD_CLOEXEC）</li>
<li>获取/设置文件描述符（cmd = F_GETFD或F_SETFD）</li>
<li>获取/设置文件状态标志（cmd = F_GETFL或F_SETFL）</li>
<li>获取/设置异步I/O所有权（cmd = F_GETOWN或F_SETOWN）</li>
<li>获取/设置记录锁（cmd = F_GETLK、F_SETLK或F_SETLKW）</li>
</ol>
<p>下面的代码对于一个文件描述符设置一个或多个文件状态标志</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"apue.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span></span><br><span class="line">set_fl(<span class="keyword">int</span> fd, <span class="keyword">int</span> flags)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">    <span class="keyword">if</span> ((val = fcntl(fd, F_GETFL, <span class="number">0</span>)) &lt; <span class="number">0</span>)</span><br><span class="line">        err_sys(<span class="string">"fcntl F_GETFL error"</span>);</span><br><span class="line">    val |= flags; <span class="comment">/* trun on flags */</span></span><br><span class="line">    <span class="keyword">if</span> (fcntl(fd, F_SETFL, val) &lt; <span class="number">0</span>)</span><br><span class="line">        err_sys(<span class="string">"fcntl F_SETFL error"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数ioctl"><a href="#函数ioctl" class="headerlink" title="函数ioctl"></a>函数ioctl</h3><p>ioctl函数是I/O操作的杂物箱，不用能本章中其他函数表示的I/O操作通常可以使用ioctl表示</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;					/* System V */</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ioctl.h&gt;			/* BSD and Linux */</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">ioctl</span><span class="params">(<span class="keyword">int</span> fd, <span class="keyword">int</span> request, ...)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="dev-fd"><a href="#dev-fd" class="headerlink" title="/dev/fd"></a>/dev/fd</h3><p>打开文件/dev/fd/n等效于复制描述符n（如果描述符n是打开的）</p>
<p>在下列函数调用中：</p>
<p><code>fd = open(&quot;/dev/fd/0&quot;, mode);</code></p>
<p>大多数系统忽略它所指定的mode，而另外一些系统则要求mode必须是所引用的文件初始打开时所使用模式的一个子集。上面的打开等效于：</p>
<p><code>fd = dup(0);</code></p>
<p>如果描述符0先前被打开为只读，那么我们也只能对fd进行读操作</p>
<h3 id="习题"><a href="#习题" class="headerlink" title="习题"></a>习题</h3><h4 id="3-1"><a href="#3-1" class="headerlink" title="3.1"></a>3.1</h4><p>所有的磁盘I/O都要经过内核的块缓存器，唯一例外的是对原始磁盘是被的I/O。术语”无缓存装置的I/O”指的是在用户的进程中对这两个函数不会自动缓存，每次read或write都要进行一次系统调用</p>
<h4 id="3-2"><a href="#3-2" class="headerlink" title="3.2"></a>3.2</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">dup_own</span><span class="params">(<span class="keyword">int</span> fd1,<span class="keyword">int</span> fd2)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i=<span class="number">0</span>,flag=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> tmp[BUFSIZE];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(fd1==fd2) <span class="keyword">return</span> fd2;</span><br><span class="line">    </span><br><span class="line">    close(fd2);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(flag)&#123;</span><br><span class="line">        tmp[i]=dup(fd1);</span><br><span class="line">        <span class="keyword">if</span>(tmp[i++]==fd2) flag=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    flag=<span class="number">1</span>,i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(flag)&#123;</span><br><span class="line">        <span class="keyword">if</span>(tmp[i]==fd2) flag=<span class="number">0</span>;</span><br><span class="line">        close(tmp[i++]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> fd2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-3"><a href="#3-3" class="headerlink" title="3.3"></a>3.3</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://hexo-blog-1252103983.cos.ap-guangzhou.myqcloud.com/20190627150748.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>

<p>当F_SETFD作用于fd1时，只影响fd1的文件描述符标志；F_SETFL作用于fd1时，则影响fd1及fd2的文件描述符标志</p>
<h4 id="3-4"><a href="#3-4" class="headerlink" title="3.4"></a>3.4</h4><p>如果fd是1，执行dup2(fd, 1)后返回1，但是没有关闭描述符1。调用3次dup2后，3个描述符指向相同的文件表项，所以不需要关闭描述符</p>
<p>如果fd是3，调用3次dup2后，有4个描述符指向相同的文件表项，所以需要关闭描述符3</p>
<h4 id="3-5"><a href="#3-5" class="headerlink" title="3.5"></a>3.5</h4><p><code>a.out &gt; outfil 2&gt;&amp;1</code></p>
<p>首先设置标准输出到outfile，然后执行dup将标准输出复制到描述符2（标准错误）上，其结果是将标准输出与标准错误设置为相同的文件，即描述符1和2指向相同的文件表项</p>
<p><code>a.out 2 &gt; &amp;1 &gt;outfile</code></p>
<p>由于首先执行dup，所以描述符2称为终端，标注输出重定向到outfile。结果是描述符1指向outfile的文件表项，描述符2指向终端的文件表项</p>
<h4 id="3-6"><a href="#3-6" class="headerlink" title="3.6"></a>3.6</h4><p>仍然可以用lseek和read函数读文件中任意一处的内容。但是write函数在写数据之前会将自动将文件移量设置为文件尾，所以写文件时只能从文件尾开始，不能再任一位置</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2019-06-27T07:16:19.821Z" itemprop="dateUpdated">2019-06-27 15:16:19</time>
</span><br>


        
        本文链接：<a href="/archives/1ffc7233.html" target="_blank" rel="external">https://zhaoziwen.com.cn/archives/1ffc7233.html</a>
        
    </div>
    
    <footer>
        <a href="https://zhaoziwen.com.cn">
            <img src="/img/psb.jpeg" alt="z2w">
            z2w
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/apue/">apue</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://zhaoziwen.com.cn/archives/1ffc7233.html&title=《APUE 第三章 文件I/O》 — Mose's blog&pic=https://zhaoziwen.com.cn/img/psb.jpeg" data-title="微博" rel="external nofollow noopener noreferrer">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://zhaoziwen.com.cn/archives/1ffc7233.html&title=《APUE 第三章 文件I/O》 — Mose's blog&source=This is a personal blog, which is belong to zhaoziwen and whose goal is to re..." data-title=" QQ" rel="external nofollow noopener noreferrer">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://zhaoziwen.com.cn/archives/1ffc7233.html" data-title=" Facebook" rel="external nofollow noopener noreferrer">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《APUE 第三章 文件I/O》 — Mose's blog&url=https://zhaoziwen.com.cn/archives/1ffc7233.html&via=https://zhaoziwen.com.cn" data-title=" Twitter" rel="external nofollow noopener noreferrer">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://zhaoziwen.com.cn/archives/1ffc7233.html" data-title=" Google+" rel="external nofollow noopener noreferrer">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/archives/f3a516e7.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">APUE 第二章 UNIX标准及实现</h4>
      </a>
    </div>
  
</nav>



    











    <!-- Valine Comments -->
    <div class="comments vcomment" id="comments"></div>
    <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script>
    <!-- Valine Comments script -->
    <script>
        var GUEST_INFO = ['nick','mail','link'];
        var guest_info = 'nick,mail,link'.split(',').filter(function(item){
          return GUEST_INFO.indexOf(item) > -1
        });
        new Valine({
            el: '#comments',
            notify: 'false' == 'true',
            verify: 'false' == 'true',
            appId: "iP2YIxmQy2buSVabbV2JgaeA-gzGzoHsz",
            appKey: "p3Mb85SlKNa9gxEMrwDeJ97o",
            avatar: "mm",
            placeholder: "Just go go",
            guest_info: guest_info.length == 0 ? GUEST_INFO : guest_info,
            pageSize: "10"
        })
    </script>
    <!-- Valine Comments end -->










</article>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style="display:none">
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style="display:none">
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="external nofollow noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>z2w &copy; 2018 - 2019</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank" rel="external nofollow noopener noreferrer">粤ICP备16110253号-2</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank" rel="external nofollow noopener noreferrer">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://zhaoziwen.com.cn/archives/1ffc7233.html&title=《APUE 第三章 文件I/O》 — Mose's blog&pic=https://zhaoziwen.com.cn/img/psb.jpeg" data-title="微博" rel="external nofollow noopener noreferrer">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://zhaoziwen.com.cn/archives/1ffc7233.html&title=《APUE 第三章 文件I/O》 — Mose's blog&source=This is a personal blog, which is belong to zhaoziwen and whose goal is to re..." data-title=" QQ" rel="external nofollow noopener noreferrer">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://zhaoziwen.com.cn/archives/1ffc7233.html" data-title=" Facebook" rel="external nofollow noopener noreferrer">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《APUE 第三章 文件I/O》 — Mose's blog&url=https://zhaoziwen.com.cn/archives/1ffc7233.html&via=https://zhaoziwen.com.cn" data-title=" Twitter" rel="external nofollow noopener noreferrer">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://zhaoziwen.com.cn/archives/1ffc7233.html" data-title=" Google+" rel="external nofollow noopener noreferrer">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACI0lEQVR42u3aUa7CIBAFUPe/ad8CFL0X2pcIp1+mqcDhYwIz83jEz/PlGb0fffM62uj36/eXPRgYGD/LyJeSM0bLGi0xgY1mwcDAOIexMvTnwPp5+jwcf1kzBgYGRrzEfOnJewwMDIz1gDt3x2zfYGBgYMylzPKw227K7XdxDAyMH2Tk4fL/f99S38DAwPgpxspF9Npl5UH2zaowMDC2ZrTTXJU4a0eL1oOBgbEpI58+D7tzQTbhDd9gYGBszZgrWOa8PJi2RYKoOQwDA2MjRt621S53rszZBm4MDIxzGCvBMS9ztt8n7WgYGBgnMPI0WTLcSuPXXCstBgbG3ozk4tqGzs+7tQIY/gsDA+MwRnsUy8PrXIEhCtwYGBgHMKK6wVTKLCHl2bOoJICBgbEp46oUf3KtXbkwP1oxBgbGMYwkpLbptmQLiuYwDAyMwxh5Ku059axQhxuKgYGxNaNN97dtrHkJM79ID8EYGBiHMe5rmGhbVIuLMQYGxjGMqw5zLbVN7X0JuBgYGJsy2uPgyqLbImg0AgYGxgGM9RRY20ixMj4GBsY5jJW0/lz5M7+gFkEcAwNja0Z7XGtTaW07RXJUbTcLAwNjD8ZKui3/V1sqyKkYGBjnMIq2hvIgeNVRMjrnYmBgYATTt6XKvKXsxoCLgYFxAGMurT/XCDv8EgMD4wBGXgy4dvrkehxtHwYGxtaM9uo4d3DMk3RtsRMDA2Nrxh8cTHRyo1RsUQAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>




<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
